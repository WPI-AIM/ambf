<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Example Review</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Overview</span></a></li>
      <li><a href="modules.html"><span>Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chapter5-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example Review </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section5-1"></a>
Introduction</h1>
<p>One of the best ways to get started with CHAI3D is to explore the different examples that come with the framework. As you explore each one of them you will quickly discover that all examples share a very similar structure and code base with minor variations between the examples.</p>
<p>In the following section we explore example <code><b>11-effects</b></code> and comment on some of the important sections of the code. Compiling and modifying existing examples is the best way to familiarize yourself with the different concepts and functionalities of the library.</p>
<div class="image">
<img src="fig-example-1.png" alt="fig-example-1.png"/>
<div class="caption">
Example 11-effects: Programming haptic effects on four spheres.</div></div>
<h1><a class="anchor" id="section5-2"></a>
Code Review</h1>
<p>Almost every application begins by creating a world in which objects, light sources, cameras, and tools can be inserted. The world acts as the root node of the entire scene graph. A uniform background color can be also assigned, though by default it is set to black. For more advanced background schemes, you can explore the 2D widgets (see class <a class="el" href="classchai3d_1_1c_background.html">cBackground</a>).</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a new world.</span></div><div class="line">world = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_world.html">cWorld</a>();</div><div class="line"></div><div class="line"><span class="comment">// set the background color of the environment to black</span></div><div class="line">world-&gt;m_backgroundColor.setBlack();</div></div><!-- fragment --><p>To graphically render a view of the world inside a window display, we need to define at least one camera that captures the world from a desired location. After creating a camera, we insert it in the world. The camera now becomes a child node of the world.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a camera</span></div><div class="line">camera = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_camera.html">cCamera</a>(world);</div><div class="line"></div><div class="line"><span class="comment">// add the camera to the world</span></div><div class="line">world-&gt;addChild(camera);</div><div class="line"></div><div class="line"><span class="comment">// position and orient the camera</span></div><div class="line">camera-&gt;set(<a class="code" href="structchai3d_1_1c_vector3d.html">cVector3d</a>(3.0, 0.0, 0.0),    <span class="comment">// camera position (eye)</span></div><div class="line">            <a class="code" href="structchai3d_1_1c_vector3d.html">cVector3d</a>(0.0, 0.0, 0.0),    <span class="comment">// lookat position (target)</span></div><div class="line">            <a class="code" href="structchai3d_1_1c_vector3d.html">cVector3d</a>(0.0, 0.0, 1.0));   <span class="comment">// direction of the (up) vector</span></div><div class="line"></div><div class="line"><span class="comment">// set the near and far clipping planes of the camera</span></div><div class="line"><span class="comment">// anything in front/behind these clipping planes will not be rendered</span></div><div class="line">camera-&gt;setClippingPlanes(0.01, 10.0);</div></div><!-- fragment --><p>CHAI3D offers some powerful capabilities to render scenes in stereo mode and on mirrored displays. Different stereo modes exist depending of the type of 3D display you own. If you are using a 3D television display, then setting the display mode to <a class="el" href="namespacechai3d.html#a91a4517831c4f1f880f348494d4161b4a84bfbd477e00d69c537dd12c21424f5f">C_STEREO_PASSIVE_TOP_BOTTOM</a> is probably your best option. You may also have to adjust settings on your television or monitor to activate the correct mode. Check the documentation of your TV or monitor to learn more about enabling 3D settings.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// set stereo mode</span></div><div class="line">camera-&gt;setStereoMode(<a class="code" href="namespacechai3d.html#a91a4517831c4f1f880f348494d4161b4a84bfbd477e00d69c537dd12c21424f5f">C_STEREO_PASSIVE_TOP_BOTTOM</a>);</div><div class="line"></div><div class="line"><span class="comment">// set stereo eye separation and focal length (applies only if stereo is enabled)</span></div><div class="line">camera-&gt;setStereoEyeSeparation(0.03);</div><div class="line">camera-&gt;setStereoFocalLength(3.0);</div><div class="line"></div><div class="line"><span class="comment">// set vertical mirrored display mode</span></div><div class="line">camera-&gt;setMirrorVertical(mirroredDisplay);</div></div><!-- fragment --><p>If your scene contains any transparent objects, then enabling multi-pass rendering can greatly improve the overall quality of the output image. This mode renders the scene in multiple passes by drawing all of the opaque objects first, followed by the transparent ones.</p>
<div class="fragment"><div class="line"><span class="comment">// enable multi-pass rendering to handle transparent objects</span></div><div class="line">camera-&gt;setUseMultipassTransparency(<span class="keyword">true</span>);</div></div><!-- fragment --><p>For the camera to "see" the objects in the scene, at least one light source needs to be added to the world. In this example we create a directional light source. The default light color is white, but can be changed to any value. See the section about <a class="el" href="group__lighting.html">lighting</a> for more information.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a light source</span></div><div class="line">light = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_directional_light.html">cDirectionalLight</a>(world);</div><div class="line"></div><div class="line"><span class="comment">// add light to world</span></div><div class="line">world-&gt;addChild(light);</div><div class="line"></div><div class="line"><span class="comment">// enable light source</span></div><div class="line">light-&gt;setEnabled(<span class="keyword">true</span>);                   </div><div class="line"></div><div class="line"><span class="comment">// define the direction</span></div><div class="line">light-&gt;setDir(-1.0, -1.0, -1.0); </div></div><!-- fragment --><p>Next, we instantiate a haptic device handler which gives us access to all of the haptic devices connected to the computer. In this example, we select the first haptic device available from the list.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a haptic device handler</span></div><div class="line">handler = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_haptic_device_handler.html">cHapticDeviceHandler</a>();</div><div class="line"></div><div class="line"><span class="comment">// get access to the first available haptic device found</span></div><div class="line">handler-&gt;getDevice(hapticDevice, 0);</div></div><!-- fragment --><p>In CHAI3D, a tool acts as a visual avatar that represents the haptic device in the world. The simplest tool is a 3D cursor, which is symbolized by a small sphere. After creating the tool, a haptic device is attached to the tool to control the position of the avatar. In the case of a cursor, we also define its radius as well as the size of the workspace in the virtual world.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a tool (cursor) and insert into the world</span></div><div class="line">tool = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_tool_cursor.html">cToolCursor</a>(world);</div><div class="line">world-&gt;addChild(tool);</div><div class="line"></div><div class="line"><span class="comment">// connect the haptic device to the virtual tool</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a763239e1780f45f546d85240d3324867">setHapticDevice</a>(hapticDevice);</div><div class="line"></div><div class="line"><span class="comment">// define a radius for the virtual tool (sphere)</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a44d2e63acbe82bda86aa48a4379c92af">setRadius</a>(0.03);</div><div class="line"></div><div class="line"><span class="comment">// map the physical workspace of the haptic device to a larger virtual workspace.</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a36477425bdc290e6020c72d420305e18">setWorkspaceRadius</a>(1.0);</div><div class="line"></div><div class="line"><span class="comment">// start the haptic tool</span></div><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a36874d3c62fa6cb052af2a950545379b">start</a>();</div></div><!-- fragment --><p>If you prefer to keep a one to one scale factor between the haptic device and the virtual workspace, then you may call the following method:</p>
<div class="fragment"><div class="line">tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#ada449d07c39f4e43eea146e51d157fcb">setWorkspaceScaleFactor</a>(1.0);</div></div><!-- fragment --><p>For each object in the scene, you can assign physical haptic properties such as, for instance, stiffness or friction. So that your application operates in a stable way on all haptic devices, you can assign haptic properties that are scaled according to the specifications and limits of your haptic device:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// read the scale factor between the physical workspace of the haptic</span></div><div class="line"><span class="comment">// device and the virtual workspace defined for the tool</span></div><div class="line"><span class="keywordtype">double</span> workspaceScaleFactor = tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#af16ee038962aaf6e6b5028786864afc3">getWorkspaceScaleFactor</a>();</div><div class="line"></div><div class="line"><span class="comment">// retrieve information about the current haptic device</span></div><div class="line"><a class="code" href="structchai3d_1_1c_haptic_device_info.html">cHapticDeviceInfo</a> hapticDeviceInfo = hapticDevice-&gt;getSpecifications();</div><div class="line"></div><div class="line"><span class="comment">// get properties of haptic device</span></div><div class="line"><span class="keywordtype">double</span> maxLinearForce = <a class="code" href="group__math.html#ga176fd748a3eb8ec13a1b5437ecd3a979">cMin</a>(hapticDeviceInfo.<a class="code" href="structchai3d_1_1c_haptic_device_info.html#a037118617d050d6e041a8ded82991f44">m_maxLinearForce</a>, 7.0);</div><div class="line"><span class="keywordtype">double</span> maxStiffness = hapticDeviceInfo.<a class="code" href="structchai3d_1_1c_haptic_device_info.html#a932eaf915ec4d703b067e167bf95262e">m_maxLinearStiffness</a> / workspaceScaleFactor;</div><div class="line"><span class="keywordtype">double</span> maxDamping   = hapticDeviceInfo.<a class="code" href="structchai3d_1_1c_haptic_device_info.html#a70519b134d8a6cb0014cf8b46ffdd4d7">m_maxLinearDamping</a> / workspaceScaleFactor;</div></div><!-- fragment --><p>Next, we create a spherical shape primitive that is inserted and positioned inside the world:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a sphere and define its radius</span></div><div class="line">object0 = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_shape_sphere.html">cShapeSphere</a>(0.3);</div><div class="line"></div><div class="line"><span class="comment">// add object to world</span></div><div class="line">world-&gt;addChild(object0);</div><div class="line"></div><div class="line"><span class="comment">// set the position of the object at the center of the world</span></div><div class="line">object0-&gt;setLocalPos(0.0, -0.5, 0.0);</div></div><!-- fragment --><p>Material and texture properties are assigned to the object:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create texture map</span></div><div class="line">object0-&gt;m_texture = <a class="code" href="classchai3d_1_1c_texture2d.html#aca2f11a46fd3fda5d88b1083800156ce">cTexture2d::create</a>();</div><div class="line"></div><div class="line"><span class="comment">// load texture map from file</span></div><div class="line">object0-&gt;m_texture-&gt;loadFromFile(<span class="stringliteral">&quot;resources/images/spheremap-3.jpg&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// set graphic properties</span></div><div class="line">object0-&gt;m_texture-&gt;setSphericalMappingEnabled(<span class="keyword">true</span>);</div><div class="line">object0-&gt;setUseTexture(<span class="keyword">true</span>);</div><div class="line">object0-&gt;m_material-&gt;setWhite();</div></div><!-- fragment --><p>Haptic properties are assigned through the material class:</p>
<div class="fragment"><div class="line"><span class="comment">// set haptic properties</span></div><div class="line">object0-&gt;m_material-&gt;setStiffness(0.4 * maxStiffness);          <span class="comment">// % of maximum linear stiffness</span></div><div class="line">object0-&gt;m_material-&gt;setMagnetMaxForce(0.6 * maxLinearForce);   <span class="comment">// % of maximum linear force </span></div><div class="line">object0-&gt;m_material-&gt;setMagnetMaxDistance(0.15);</div><div class="line">object0-&gt;m_material-&gt;setViscosity(0.1 * maxDamping);            <span class="comment">// % of maximum linear damping</span></div></div><!-- fragment --><p>Once the haptic values are defined in the material class, we still need to enable the effects that will use these values. In this example, we enable three haptic effects that occur when the tool touches the sphere. If the effects are not initialized, then the haptic values assigned to the material class are simply ignored.</p>
<div class="fragment"><div class="line"><span class="comment">// create a haptic surface effect</span></div><div class="line">object0-&gt;createEffectSurface();</div><div class="line"></div><div class="line"><span class="comment">// create a haptic magnetic effect</span></div><div class="line">object0-&gt;createEffectMagnetic();</div><div class="line"></div><div class="line"><span class="comment">// create a haptic viscous effect</span></div><div class="line">object0-&gt;createEffectViscosity();</div></div><!-- fragment --><p>To display any 2D information in a scene, we use widgets. In this example, we first define a <a class="el" href="classchai3d_1_1c_font.html">font</a> and create a <a class="el" href="classchai3d_1_1c_label.html">label</a> that display the rate at which the simulation is running. The label is placed on the front layer of the camera and will be displayed in overlay to the world.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a font</span></div><div class="line"><a class="code" href="classchai3d_1_1c_font.html">cFont</a> *font = <a class="code" href="namespacechai3d.html#af8ad087918683eb3afe1669c641f0516">NEW_CFONTCALIBRI20</a>();</div><div class="line"></div><div class="line"><span class="comment">// create a label to display the haptic rate of the simulation</span></div><div class="line">labelHapticRate = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_label.html">cLabel</a>(font);</div><div class="line">camera-&gt;m_frontLayer-&gt;addChild(labelHapticRate);</div></div><!-- fragment --><p>Now that the scene is built we can start a haptics thread (&gt; 1000 Hz) which runs independently from the much slower graphics thread (20-50 Hz).</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacechai3d.html">chai3d</a>;</div><div class="line"></div><div class="line"><span class="comment">// create a thread which starts the main haptics rendering loop</span></div><div class="line"><a class="code" href="classchai3d_1_1c_thread.html">cThread</a>* hapticsThread = <span class="keyword">new</span> <a class="code" href="classchai3d_1_1c_thread.html">cThread</a>();</div><div class="line">hapticsThread-&gt;<a class="code" href="classchai3d_1_1c_thread.html#a0b1f7650fcf31be4db6fc4f0b3a23ac8">start</a>(updateHaptics, <a class="code" href="namespacechai3d.html#a39ae8b7062d3d320a8aaeaa75afe2349a9e7903a1c87aa2638571ac8eb192a7e6">CTHREAD_PRIORITY_HAPTICS</a>);</div></div><!-- fragment --><p>Finally, here is a snapshot of the haptics loop which runs at best effort. At every iteration, the position in global coordinates is computed for every object in the world. The position of the tool is then updated by reading the sensors of the haptic device. The interaction forces between the tool and the world are computed, and the resulting force is sent back to the haptic device for display.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> updateHaptics(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">// simulation in now running</span></div><div class="line">    simulationRunning  = <span class="keyword">true</span>;</div><div class="line">    simulationFinished = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">// main haptic simulation loop</span></div><div class="line">    <span class="keywordflow">while</span>(simulationRunning)</div><div class="line">    {</div><div class="line">        <span class="comment">// compute global reference frames for each object</span></div><div class="line">        world-&gt;computeGlobalPositions(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// update position and orientation of tool</span></div><div class="line">        tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#a68152df29e432069d16ca2aa2e1b5c71">updateFromDevice</a>();</div><div class="line"></div><div class="line">        <span class="comment">// compute interaction forces</span></div><div class="line">        tool-&gt;<a class="code" href="classchai3d_1_1c_tool_cursor.html#a44a8e38e7ff64541119dd2832eb79776">computeInteractionForces</a>();</div><div class="line"></div><div class="line">        <span class="comment">// send forces to haptic device</span></div><div class="line">        tool-&gt;<a class="code" href="classchai3d_1_1c_generic_tool.html#ae85e757389b7f287eb50f4df44c5ca90">applyToDevice</a>();</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">// exit haptics thread</span></div><div class="line">    simulationFinished = <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
